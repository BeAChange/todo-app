CREATE SCHEMA IF NOT EXISTS TESTDB;

CREATE TABLE IF NOT EXISTS TESTDB.TODOLIST (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY,
    TITLE VARCHAR(50) NOT NULL,
    CREATED_DATE DATE,
    MODIFIED_DATE DATE,
    IS_ACTIVE BOOLEAN,
    PRIMARY KEY (ID)
);


CREATE TABLE IF NOT EXISTS TESTDB.TASK (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY,
	DESCRIPTION VARCHAR(500) NOT NULL,
	STATUS VARCHAR(25),
	CREATED_DATE DATE,
	DUE_DATE DATE,
	TOTAL_TIME_SPENT DECIMAL,
	PRV_TOTAL_TIME_SPENT DECIMAL,
	IS_ACTIVE BOOLEAN,
	PRIMARY KEY (ID)
);


CREATE TABLE IF NOT EXISTS TESTDB.USER_PROFILE (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY,
	USER_NAME VARCHAR(30) NOT NULL,
	FIRST_NAME VARCHAR(50) NOT NULL,
	MIDDLE_NAME VARCHAR(50),
	LAST_NAME VARCHAR(50) NOT NULL,
	ROLE_ID VARCHAR(5),
	EMAIL   VARCHAR(120),
	CREATED_DATE DATE,
	MODIFIED_DATE DATE,
	IS_ACTIVE BOOLEAN,
	PRIMARY KEY (ID)
);

ALTER TABLE TESTDB.USER_PROFILE ADD CONSTRAINT todo_userName_Unique UNIQUE (USER_NAME);

CREATE TABLE IF NOT EXISTS TESTDB.TODOLIST_TASK (
    TODOLIST_ID BIGINT NOT NULL,
    TASK_ID BIGINT NOT NULL,
    PRIMARY KEY (TODOLIST_ID,TASK_ID),
    FOREIGN KEY (TODOLIST_ID) REFERENCES TESTDB.TODOLIST(ID) ON DELETE CASCADE,
    FOREIGN KEY (TASK_ID) REFERENCES TESTDB.TASK(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS TESTDB.TASK_ASSIGNMENT (
    TASK_ID BIGINT NOT NULL,
	USER_ID BIGINT NOT NULL,
	PRIMARY KEY (TASK_ID,USER_ID),
	FOREIGN KEY (TASK_ID) REFERENCES TESTDB.TASK(ID) ON DELETE CASCADE,
	FOREIGN KEY (USER_ID) REFERENCES TESTDB.USER_PROFILE(ID) ON DELETE CASCADE
);


CREATE TABLE IF NOT EXISTS TESTDB.USR (
  ID INT AUTO_INCREMENT PRIMARY KEY,
  NAME VARCHAR(250) NOT NULL,
  LOGIN VARCHAR(250) NOT NULL,
  PASSWORD VARCHAR(250) NOT NULL
);

-- PASSWORD (MD5) : 123
INSERT INTO TESTDB.USR (NAME, LOGIN, PASSWORD) VALUES ('admin', 'admin', '202cb962ac59075b964b07152d234b70');
